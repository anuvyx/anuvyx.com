<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anuvyx - Autenticación</title>
  <link rel="stylesheet" href="../styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="../static/logo/favicon.ico">
  <script>
    // Si ya se inició sesión, redirigir al index
    if (localStorage.getItem("isLoggedIn") === "true") {
      window.location.href = "../index.html";
    }
  </script>
</head>
<body class="auth-page">
  <!-- Auth Navigation -->
  <nav class="auth-nav">
    <a href="../index.html" class="nav-logo">
      <img src="../static/logo/Anuvyx-White-NB.PNG" alt="Logo Anuvyx" class="logo-img">
    </a>
  </nav>

  <!-- Auth Container -->
  <div class="auth-container">
    <!-- Login Section -->
    <section class="auth-section active" id="loginSection">
      <div class="auth-content">
        <h2>Iniciar Sesión</h2>
        <form id="loginForm">
          <div class="input-group">
            <input type="email" id="email" name="email" required>
            <label for="email">Correo electrónico</label>
          </div>
          <div class="input-group">
            <input type="password" id="password" name="password" required>
            <label for="password">Contraseña</label>
          </div>
          <button type="submit" class="cta-button">Acceder</button>
          <p class="auth-links">
            ¿No tienes cuenta? <a href="#signup" class="switch-form">Regístrate aquí</a><br>
            <a href="#forgot-password">¿Olvidaste tu contraseña?</a>
          </p>
        </form>
      </div>
    </section>

    <!-- Signup Section -->
    <section class="auth-section" id="signupSection">
      <div class="auth-content">
        <h2>Crear Cuenta</h2>
        <form id="signUpForm">
          <div class="input-group">
            <input type="text" id="name" name="name" required>
            <label for="name">Nombre completo</label>
          </div>
          <div class="input-group">
            <input type="email" id="emailSignUp" name="email" required>
            <label for="emailSignUp">Correo electrónico</label>
          </div>
          <div class="input-group">
            <input type="password" id="passwordSignUp" name="password" required>
            <label for="passwordSignUp">Contraseña</label>
          </div>
          <div class="input-group">
            <input type="password" id="confirmPassword" name="confirmPassword" required>
            <label for="confirmPassword">Confirmar contraseña</label>
          </div>
          <button type="submit" class="cta-button">Registrarse</button>
          <p class="auth-links">
            ¿Ya tienes cuenta? <a href="#login" class="switch-form">Inicia sesión aquí</a>
          </p>
        </form>
      </div>
    </section>
  </div>

  <!-- Auth Script -->
  <script>
    // Función para agregar el toggle de visibilidad usando SVGs
    function addTogglePassword(idInput) {
      const input = document.getElementById(idInput);
      if (!input) return;
      
      const label = input.nextElementSibling;
      if (label && label.tagName.toLowerCase() !== 'label') return;
      
      if (label.nextElementSibling && label.nextElementSibling.classList.contains('toggle-password')) {
        label.nextElementSibling.remove();
      }
      
      const wrapper = document.createElement('div');
      wrapper.style.position = 'relative';
      
      input.parentNode.insertBefore(wrapper, input);
      wrapper.appendChild(input);
      if (label && label.tagName.toLowerCase() === 'label') {
        wrapper.appendChild(label);
      }
      
      input.style.width = '100%';
      
      const toggleIcon = document.createElement('span');
      toggleIcon.classList.add('toggle-password-icon');
      toggleIcon.style.position = 'absolute';
      toggleIcon.style.top = '50%';
      toggleIcon.style.right = '10px';
      toggleIcon.style.transform = 'translateY(-50%)';
      toggleIcon.style.cursor = 'pointer';
      
      const eyeSVG = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
      `;
      
      const eyeSlashSVG = `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
      </svg>
      `;
      
      toggleIcon.innerHTML = eyeSlashSVG;
      wrapper.appendChild(toggleIcon);
      
      toggleIcon.addEventListener('click', () => {
        if (input.type === 'password') {
          input.type = 'text';
          toggleIcon.innerHTML = eyeSVG;
        } else {
          input.type = 'password';
          toggleIcon.innerHTML = eyeSlashSVG;
        }
      });
    }
    
    document.addEventListener("DOMContentLoaded", () => {
      // Alternar entre formularios
      document.querySelectorAll('.switch-form').forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          document.querySelectorAll('.auth-section').forEach(section => {
            section.classList.remove('active');
          });
          const target = e.target.hash === '#signup' ? 
            document.getElementById('signupSection') : 
            document.getElementById('loginSection');
          target.classList.add('active');
        });
      });
      
      // Agregamos el toggle de visibilidad a los inputs de contraseña
      addTogglePassword('password');
      addTogglePassword('passwordSignUp');
      addTogglePassword('confirmPassword');

      // Login Form
      document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        try {
          const response = await fetch('https://anuvyx-backend.vercel.app/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          
          if (!response.ok) throw new Error(await response.text());
          
          const data = await response.json();
          // Guardamos el estado de sesión y los datos del usuario
          localStorage.setItem("isLoggedIn", "true");
          localStorage.setItem("userData", JSON.stringify(data.user));
          
          window.location.href = '../index.html';
        } catch (error) {
          console.error('Login error:', error);
          alert('Error en el inicio de sesión. Verifica tus credenciales.');
        }
      });
      
      // Signup Form
      document.getElementById('signUpForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
          name: document.getElementById('name').value,
          email: document.getElementById('emailSignUp').value,
          password: document.getElementById('passwordSignUp').value,
          confirmPassword: document.getElementById('confirmPassword').value
        };

        if (formData.password !== formData.confirmPassword) {
          return alert('Las contraseñas no coinciden');
        }

        try {
          const response = await fetch('https://anuvyx-backend.vercel.app/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });

          if (!response.ok) throw new Error(await response.text());

          window.location.href = 'welcome.html';
          
          alert('Registro exitoso! Por favor inicia sesión.');
          document.getElementById('loginSection').classList.add('active');
          document.getElementById('signupSection').classList.remove('active');
        } catch (error) {
          console.error('Signup error:', error);
          alert('Error en el registro: ' + error.message);
        }
      });
    });
  </script>
</body>
</html>
