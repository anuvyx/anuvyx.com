<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil de Usuario - Anuvyx</title>
  <link rel="stylesheet" href="../styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="../static/logo/favicon.ico">
  <!-- Estilos espec√≠ficos para el perfil -->
  <style>
    .profile-section {
      padding: 120px 2rem 2rem;
      min-height: 100vh;
      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)),
                  url('../static/index/ia-banner.avif');
      background-size: cover;
      background-position: center;
    }
    .profile-container {
      max-width: 1200px;
      margin: 50px auto;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 4px 15px rgba(0, 113, 227, 0.2);
    }
    .profile-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    .profile-picture {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      margin: 0 auto 1rem;
      background: url('../static/icons/user-icon-black.png') center/cover;
      position: relative;
      border: 3px solid #0071e3;
    }
    .edit-overlay {
      position: absolute;
      bottom: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.7);
      padding: 0.5rem;
      border-radius: 50%;
      cursor: pointer;
    }
    .profile-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
    }
    .profile-sidebar {
      border-right: 1px solid #333;
      padding-right: 2rem;
    }
    .profile-info h2 {
      color: #0071e3;
      margin-bottom: 1.5rem;
    }
    .info-group {
      margin-bottom: 1.5rem;
      position: relative;
    }
    .info-group label {
      display: block;
      color: #888;
      margin-bottom: 0.5rem;
    }
    .info-group input,
    .info-group select,
    .info-group textarea {
      width: 100%;
      padding: 0.8rem;
      background: #111;
      border: 1px solid #333;
      color: #fff;
      border-radius: 8px;
      transition: all 0.3s;
    }
    /* Desactivar el redimensionamiento y l√≠mite de caracteres */
    #userBio {
      resize: none;
    }
    .info-group input:focus,
    .info-group textarea:focus,
    .info-group select:focus {
      border-color: #0071e3;
      outline: none;
    }
    .toggle-password-icon {
      position: absolute;
      top: 50%;
      right: 12px;
      transform: translateY(-50%);
      cursor: pointer;
    }
    .security-section {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 1px solid #333;
    }
    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    .disabled-input {
      background: #222 !important;
      cursor: not-allowed;
    }
    @media (max-width: 768px) {
      .profile-grid {
        grid-template-columns: 1fr;
      }
      .profile-sidebar {
        border-right: none;
        padding-right: 0;
        border-bottom: 1px solid #333;
        padding-bottom: 2rem;
      }
      .profile-container {
        padding: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar" onclick="window.location.reload()" style="cursor: pointer;" title="Recargar">
    <a href="../index.html#hero" class="company-name">ANUVYX</a>
  </div>
  <!-- Navigation Bar -->
  <nav class="nav">
    <a href="../index.html#hero" class="nav-logo">
      <img src="../static/logo/Anuvyx-White-NB.PNG" alt="Logo Anuvyx" class="logo-img" title="Inicio">
    </a>
    <div class="menu-toggle"><span></span><span></span><span></span></div>
    <div class="nav-links">
      <a href="../index.html#ia" class="nav-link">IA</a>
      <a href="../index.html#iot" class="nav-link">IoT</a>
      <a href="../index.html#blockchain" class="nav-link">Blockchain</a>
      <a href="../index.html#metaverso" class="nav-link">Metaverso</a>
      <a href="../index.html#energias" class="nav-link">Energ√≠as Limpias</a>
    </div>
  </nav>

  <!-- Main Profile Content -->
  <main class="profile-section">
    <div class="profile-container">
      <div class="profile-header">
        <div class="profile-picture">
          <div class="edit-overlay">üì∑</div>
        </div>
        <h1>Perfil de Usuario</h1>
      </div>
      <div class="profile-grid">
        <div class="profile-sidebar">
          <div class="profile-info">
            <h2>Informaci√≥n B√°sica</h2>
            <div class="info-group">
              <label>Nombre completo</label>
              <input id="userName" type="text" class="disabled-input" readonly>
            </div>
            <div class="info-group">
              <label>Correo electr√≥nico</label>
              <input id="userEmail" type="email" class="disabled-input" readonly>
            </div>
            <div class="info-group">
              <label>Fecha de registro</label>
              <input id="registrationDate" type="text" class="disabled-input" readonly>
            </div>
          </div>
        </div>

        <div class="profile-content">
          <div class="profile-info">
            <h2>Detalles Personales</h2>
            <div class="info-group">
              <label>Biograf√≠a</label>
              <textarea id="userBio" rows="4" maxlength="150" placeholder="Cu√©ntanos algo sobre ti..."></textarea>
            </div>
            <div class="info-group">
              <label>Pa√≠s</label>
              <select id="userCountry">
                <option value="">Selecciona tu pa√≠s</option>
                <option>M√©xico</option>
                <option>Espa√±a</option>
                <option>Argentina</option>
                <option>Colombia</option>
              </select>
            </div>
          </div>

          <div class="security-section">
            <h2>Seguridad</h2>
            <div class="info-group">
              <label>Contrase√±a actual</label>
              <input id="currentPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div class="info-group">
              <label>Nueva contrase√±a</label>
              <input id="newPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div class="info-group">
              <label>Confirmar nueva contrase√±a</label>
              <input id="confirmNewPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <div class="button-group">
              <button class="cta-button">Guardar Cambios</button>
              <button class="cta-button" style="background: #333;">Cancelar</button>
            </div>
          </div>
        </div>
      </div>

      <div class="security-section">
        <h2>Zona Peligrosa</h2>
        <div class="button-group">
          <button id="deleteAccountBtn" class="cta-button" style="background: #dc3545;">
            Eliminar Cuenta
          </button>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p class="copyright">&copy; 2025 Anuvyx. Todos los derechos reservados.</p>
  </footer>

  <script src="../script.js"></script>
  <script>
    // Verificar sesi√≥n
    if (localStorage.getItem("isLoggedIn") !== "true") {
      alert("Acceso denegado. Por favor, inicia sesi√≥n primero.");
      window.location.href = "../index.html#login";
    }

    // Funci√≥n para mostrar/ocultar contrase√±as
    function addTogglePassword(idInput) {
      const input = document.getElementById(idInput);
      if (!input) return;
      const wrapper = document.createElement('div');
      wrapper.style.position = 'relative';
      input.parentNode.insertBefore(wrapper, input);
      wrapper.appendChild(input);

      const eyeSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>`;
      const eyeSlashSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
      </svg>`;
      const toggleIcon = document.createElement('span');
      toggleIcon.classList.add('toggle-password-icon');
      toggleIcon.innerHTML = eyeSlashSVG;
      wrapper.appendChild(toggleIcon);

      toggleIcon.addEventListener('click', () => {
        if (input.type === 'password') {
          input.type = 'text';
          toggleIcon.innerHTML = eyeSVG;
        } else {
          input.type = 'password';
          toggleIcon.innerHTML = eyeSlashSVG;
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      // Llenar datos de usuario
      const userData = JSON.parse(localStorage.getItem('userData') || '{}');
      if (!userData.email) {
        alert("Datos de usuario no encontrados. Por favor, inicia sesi√≥n.");
        window.location.href = "../index.html#login";
        return;
      }
      document.getElementById('userName').value = userData.name || '';
      document.getElementById('userEmail').value = userData.email;
      document.getElementById('registrationDate').value = userData.registrationDate || '';
      document.getElementById('userBio').value = userData.bio || '';
      document.getElementById('userCountry').value = userData.country || '';

      // A√±adir toggle de visibilidad a los campos de contrase√±a
      addTogglePassword('currentPassword');
      addTogglePassword('newPassword');
      addTogglePassword('confirmNewPassword');

      // Eliminar Cuenta
      document.getElementById('deleteAccountBtn').addEventListener('click', async () => {
        if (!confirm("¬øEst√°s seguro de que deseas eliminar tu cuenta? Esta acci√≥n no se puede deshacer.")) return;
        const inputEmail = prompt("Por favor, ingresa tu correo electr√≥nico para confirmar:");
        if (!inputEmail) return alert("Operaci√≥n cancelada.");
        if (inputEmail !== userData.email) return alert("El correo ingresado no coincide con tu cuenta.");
        const inputPassword = prompt("Por favor, ingresa tu contrase√±a:");
        if (!inputPassword) return alert("Operaci√≥n cancelada.");

        try {
          const response = await fetch('https://anuvyx-backend.vercel.app/api/delete-account', {
            method: 'DELETE',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: inputEmail, password: inputPassword })
          });
          const result = await response.json();
          if (!response.ok) throw new Error(result.error || 'Error al eliminar la cuenta');
          localStorage.clear();
          alert('Tu cuenta ha sido eliminada correctamente.');
          window.location.href = '../index.html';
        } catch (error) {
          console.error('Delete account error:', error);
          alert('No se pudo eliminar la cuenta: ' + error.message);
        }
      });

      // Subir foto de perfil
      document.querySelector('.edit-overlay').addEventListener('click', function() {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'image/*';
        fileInput.onchange = function(event) {
          const file = event.target.files[0];
          const reader = new FileReader();
          reader.onload = function(e) {
            document.querySelector('.profile-picture').style.backgroundImage = `url(${e.target.result})`;
          };
          reader.readAsDataURL(file);
        };
        fileInput.click();
      });
    });
  </script>
</body>
</html>
